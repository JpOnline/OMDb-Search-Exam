<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="list-item.html">

<dom-module id="list-view">
  <template>

    <h2>List</h2>

    <!-- Looks like OBDb is not free anymore, using themoviedb instead -->
    <iron-ajax
      auto
      url="https://api.themoviedb.org/3/search/movie"
      params='{{requestParams}}'
      handle-as="json"
      on-response="handleResponse"
      on-error="handleError"
      debouce-duration="300"
    ></iron-ajax>

    <paper-input value="{{requestParams.query}}"></paper-input>

    <template is="dom-repeat" items="{{movies}}" as="movie">
      <list-item movie-meta-data="{{movie}}"></list-item>
    </template>

  </template>
  <script>
    class ListView extends Polymer.Element{
      static get is() { return 'list-view'; }
      static get properties() {
        return {
          requestParams: {
            type: Object,
            value: function(){ return {
              api_key: 'afb4449b08bf540b098d1ed1aa52eba3'
            };}
          },
          movies: {
            type: Array,
            value: function(){return [];}
          }
        };
      }
      handleResponse(e){
        console.log(e);
        try{
          this.set('movies', e.detail.response.results);
        }catch(err){
          console.error('I could not read the movie results, here is the error', err);
          console.error('and here is the event', e);
        }
      }
      handleError(e){
        if(!this.requestParams.query || this.requestParams.query === ''){
          this.set('movies', []);
        }else{
          console.error('iron-ajax error', e.detail);
        }
      }
    }

    customElements.define(ListView.is, ListView);
  </script>
</dom-module >
